\hypertarget{classMobi_1_1Converter}{\section{Mobi\+:\+:Converter Class Reference}
\label{classMobi_1_1Converter}\index{Mobi\+::\+Converter@{Mobi\+::\+Converter}}
}


{\ttfamily \#include $<$converter.\+h$>$}

Inheritance diagram for Mobi\+:\+:Converter\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{classMobi_1_1Converter}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classMobi_1_1Converter_a1de81f3e06093411e5d27ce882bc010f}{Converter} ()
\item 
\hyperlink{classMobi_1_1Converter_a9ecd05695a52c03158b81e544e13b996}{$\sim$\+Converter} ()
\item 
virtual Q\+Text\+Document $\ast$ \hyperlink{classMobi_1_1Converter_aa63e543977130604de659a4d725ee8bd}{convert} (const Q\+String \&file\+Name)
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 20 of file converter.\+h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classMobi_1_1Converter_a1de81f3e06093411e5d27ce882bc010f}{\index{Mobi\+::\+Converter@{Mobi\+::\+Converter}!Converter@{Converter}}
\index{Converter@{Converter}!Mobi\+::\+Converter@{Mobi\+::\+Converter}}
\subsubsection[{Converter}]{\setlength{\rightskip}{0pt plus 5cm}Converter\+::\+Converter (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classMobi_1_1Converter_a1de81f3e06093411e5d27ce882bc010f}


Definition at line 25 of file converter.\+cpp.


\begin{DoxyCode}
26 \{
27   
28 \}
\end{DoxyCode}
\hypertarget{classMobi_1_1Converter_a9ecd05695a52c03158b81e544e13b996}{\index{Mobi\+::\+Converter@{Mobi\+::\+Converter}!````~Converter@{$\sim$\+Converter}}
\index{````~Converter@{$\sim$\+Converter}!Mobi\+::\+Converter@{Mobi\+::\+Converter}}
\subsubsection[{$\sim$\+Converter}]{\setlength{\rightskip}{0pt plus 5cm}Converter\+::$\sim$\+Converter (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classMobi_1_1Converter_a9ecd05695a52c03158b81e544e13b996}


Definition at line 30 of file converter.\+cpp.


\begin{DoxyCode}
31 \{    
32 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{classMobi_1_1Converter_aa63e543977130604de659a4d725ee8bd}{\index{Mobi\+::\+Converter@{Mobi\+::\+Converter}!convert@{convert}}
\index{convert@{convert}!Mobi\+::\+Converter@{Mobi\+::\+Converter}}
\subsubsection[{convert}]{\setlength{\rightskip}{0pt plus 5cm}Q\+Text\+Document $\ast$ Converter\+::convert (
\begin{DoxyParamCaption}
\item[{const Q\+String \&}]{file\+Name}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classMobi_1_1Converter_aa63e543977130604de659a4d725ee8bd}
Returns the generated Q\+Text\+Document object. 

Implements \hyperlink{classOkular_1_1TextDocumentConverter_ad05f8bcde0f347c6292968fab331bcef}{Okular\+::\+Text\+Document\+Converter}.



Definition at line 49 of file converter.\+cpp.


\begin{DoxyCode}
50 \{
51   \hyperlink{classMobi_1_1MobiDocument}{MobiDocument}* newDocument=\textcolor{keyword}{new} \hyperlink{classMobi_1_1MobiDocument}{MobiDocument}(fileName);
52   \textcolor{keywordflow}{if} (!newDocument->\hyperlink{classMobi_1_1MobiDocument_a22ca18d34e4e1f9f3aacf54ed7d274c8}{mobi}()->isValid()) \{
53     emit \hyperlink{classOkular_1_1TextDocumentConverter_a93f1335bdd8232626364c973d9d7e6b4}{error}(i18n(\textcolor{stringliteral}{"Error while opening the Mobipocket document."}), -1);
54     \textcolor{keyword}{delete} newDocument;
55     \textcolor{keywordflow}{return} NULL;
56   \}
57   \textcolor{keywordflow}{if} (newDocument->\hyperlink{classMobi_1_1MobiDocument_a22ca18d34e4e1f9f3aacf54ed7d274c8}{mobi}()->hasDRM()) \{
58     emit \hyperlink{classOkular_1_1TextDocumentConverter_a93f1335bdd8232626364c973d9d7e6b4}{error}(i18n(\textcolor{stringliteral}{"This book is protected by DRM and can be displayed only on designated device"}), -
      1);
59     \textcolor{keyword}{delete} newDocument;
60     \textcolor{keywordflow}{return} NULL;
61   \}
62   
63   handleMetadata(newDocument->\hyperlink{classMobi_1_1MobiDocument_a22ca18d34e4e1f9f3aacf54ed7d274c8}{mobi}()->metadata());
64   newDocument->setPageSize(QSizeF(600, 800));
65 
66   QTextFrameFormat frameFormat;
67   frameFormat.setMargin( 20 );
68   QTextFrame *rootFrame = newDocument->rootFrame();
69   rootFrame->setFrameFormat( frameFormat ); 
70   \hyperlink{classQMap}{QMap<QString,QPair<int,int>} > links;
71   \hyperlink{classQMap}{QMap<QString,QTextBlock>} targets;
72 
73   \textcolor{comment}{// go over whole document and add all <a> tags to links or targets map}
74   \textcolor{keywordflow}{for} (QTextBlock it = newDocument->begin(); it != newDocument->end(); it = it.next()) 
75    \textcolor{keywordflow}{for} (QTextBlock::iterator fit=it.begin(); !fit.atEnd(); ++fit) \{
76     QTextFragment frag=fit.fragment();
77     QTextCharFormat format=frag.charFormat();
78     \textcolor{keywordflow}{if} (!format.isAnchor()) \textcolor{keywordflow}{continue};
79     \textcolor{comment}{//link}
80     \textcolor{keywordflow}{if} (!format.anchorHref().isEmpty()) links[format.anchorHref()]=
81       \hyperlink{structQPair}{QPair<int,int>}(frag.position(), frag.position()+frag.length());
82     \textcolor{keywordflow}{if} (!format.anchorNames().isEmpty()) \{
83       \textcolor{comment}{// link targets}
84       Q\_FOREACH(\textcolor{keyword}{const} QString& name, format.anchorNames()) 
85     targets[\textcolor{charliteral}{'#'}+name]=it;
86     \}
87   \}
88 
89   \textcolor{comment}{// create link actions}
90   QMapIterator<QString,QPair<int,int> > it(links);
91   \textcolor{keywordflow}{while} (it.hasNext()) \{
92     it.next();
93     QUrl u(it.key());
94     \textcolor{comment}{// external or internal link}
95     \textcolor{keywordflow}{if} (!u.isRelative()) emit \hyperlink{classOkular_1_1TextDocumentConverter_ac4f1b668547e87affede3663ea6d8bc6}{addAction}(\textcolor{keyword}{new} \hyperlink{classOkular_1_1BrowseAction}{Okular::BrowseAction}(it.key()), it
      .value().first, it.value().second);
96     \textcolor{keywordflow}{else} \{
97       \textcolor{comment}{// is there valid target?}
98       \textcolor{keywordflow}{if} (!targets.contains( it.key() ) || !targets[it.key()].isValid()) \textcolor{keywordflow}{continue};
99       emit \hyperlink{classOkular_1_1TextDocumentConverter_ac4f1b668547e87affede3663ea6d8bc6}{addAction}(\textcolor{keyword}{new} \hyperlink{classOkular_1_1GotoAction}{Okular::GotoAction}(QString(), 
      \hyperlink{classOkular_1_1TextDocumentConverter_a5d8709540be1213da6dac78759ce7172}{calculateViewport}( newDocument, targets[it.key()] )),
100         it.value().first, it.value().second);
101     \}
102     
103   \}
104 
105   \textcolor{keywordflow}{return} newDocument;
106 \}
\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
generators/mobipocket/\hyperlink{mobipocket_2converter_8h}{converter.\+h}\item 
generators/mobipocket/\hyperlink{mobipocket_2converter_8cpp}{converter.\+cpp}\end{DoxyCompactItemize}
