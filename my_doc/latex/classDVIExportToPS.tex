\hypertarget{classDVIExportToPS}{\section{D\+V\+I\+Export\+To\+P\+S Class Reference}
\label{classDVIExportToPS}\index{D\+V\+I\+Export\+To\+P\+S@{D\+V\+I\+Export\+To\+P\+S}}
}


{\ttfamily \#include $<$dviexport.\+h$>$}

Inheritance diagram for D\+V\+I\+Export\+To\+P\+S\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{classDVIExportToPS}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDVIExportToPS_acd020f645187eca0256e4d009110d734}{D\+V\+I\+Export\+To\+P\+S} (\hyperlink{classdviRenderer}{dvi\+Renderer} \&parent, Q\+Widget $\ast$parent\+\_\+widget, const Q\+String \&output\+\_\+name, const Q\+String\+List \&options, Q\+Printer $\ast$printer, bool use\+Font\+Hinting, Q\+Printer\+::\+Orientation orientation=Q\+Printer\+::\+Portrait)
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 117 of file dviexport.\+h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classDVIExportToPS_acd020f645187eca0256e4d009110d734}{\index{D\+V\+I\+Export\+To\+P\+S@{D\+V\+I\+Export\+To\+P\+S}!D\+V\+I\+Export\+To\+P\+S@{D\+V\+I\+Export\+To\+P\+S}}
\index{D\+V\+I\+Export\+To\+P\+S@{D\+V\+I\+Export\+To\+P\+S}!D\+V\+I\+Export\+To\+P\+S@{D\+V\+I\+Export\+To\+P\+S}}
\subsubsection[{D\+V\+I\+Export\+To\+P\+S}]{\setlength{\rightskip}{0pt plus 5cm}D\+V\+I\+Export\+To\+P\+S\+::\+D\+V\+I\+Export\+To\+P\+S (
\begin{DoxyParamCaption}
\item[{{\bf dvi\+Renderer} \&}]{parent, }
\item[{Q\+Widget $\ast$}]{parent\+\_\+widget, }
\item[{const Q\+String \&}]{output\+\_\+name, }
\item[{const Q\+String\+List \&}]{options, }
\item[{Q\+Printer $\ast$}]{printer, }
\item[{bool}]{use\+Font\+Hinting, }
\item[{Q\+Printer\+::\+Orientation}]{orientation = {\ttfamily QPrinter\+:\+:Portrait}}
\end{DoxyParamCaption}
)}}\label{classDVIExportToPS_acd020f645187eca0256e4d009110d734}

\begin{DoxyParams}{Parameters}
{\em parent} & is stored internally in order to inform the parent that the external process has finished. \\
\hline
{\em parent\+\_\+widget} & is passed to all Qt widgets. \\
\hline
{\em output\+\_\+name} & is the name of the Post\+Script file that is to contain the exported data. If this variable is empty, the user will be asked to supply a file name. \\
\hline
{\em options} & extra command line arguments that are to be passed to the external process's argv command line. \\
\hline
{\em printer} & having generated the Post\+Script file, it is passed to {\ttfamily printer} (if not null). \\
\hline
{\em orientation} & the original orientation of the document \\
\hline
\end{DoxyParams}


Definition at line 221 of file dviexport.\+cpp.


\begin{DoxyCode}
228   : \hyperlink{classDVIExport_a126208c08ed676e76ca5442da3c6ae79}{DVIExport}(parent, parent\_widget),
229     printer\_(printer),
230     orientation\_(orientation)
231 \{
232   \textcolor{comment}{// None of these should happen. Paranoia checks.}
233   \textcolor{keywordflow}{if} (!parent.\hyperlink{classdviRenderer_a67ded13a1a8da343aa0ee921ed96d4c2}{dviFile})
234     \textcolor{keywordflow}{return};
235   \textcolor{keyword}{const} \hyperlink{classdvifile}{dvifile}& dvi = *(parent.\hyperlink{classdviRenderer_a67ded13a1a8da343aa0ee921ed96d4c2}{dviFile});
236 
237   \textcolor{keyword}{const} QFileInfo input(dvi.\hyperlink{classdvifile_a1c0fe420231e71f256b5db367b7e1178}{filename});
238   \textcolor{keywordflow}{if} (!input.exists() || !input.isReadable())
239     \textcolor{keywordflow}{return};
240 
241   \textcolor{keywordflow}{if} (dvi.\hyperlink{classdvifile_aeafc97277647ad5077a774be71b3253a}{page\_offset}.isEmpty())
242     \textcolor{keywordflow}{return};
243 
244   \textcolor{keywordflow}{if} (dvi.\hyperlink{classdvifile_a341ffd0f617655a308d5d86fbb085400}{numberOfExternalNONPSFiles} != 0) \{
245     emit \hyperlink{classDVIExport_af4dc2cb358975a05b15c145fbe8d4e8f}{error}(i18n(\textcolor{stringliteral}{"This DVI file refers to external graphic files which are not in PostScript
       format, and cannot be handled by the "}
246                     \textcolor{stringliteral}{"'dvips' program that Okular uses internally to print or to export to PostScript. The
       functionality that "}
247                     \textcolor{stringliteral}{"you require is therefore unavailable in this version of Okular."}), -1);
248     \textcolor{keywordflow}{return};
249   \}
250 
251   \textcolor{keywordflow}{if} (KStandardDirs::findExe(\textcolor{stringliteral}{"dvips"}).isEmpty()) \{
252     emit \hyperlink{classDVIExport_af4dc2cb358975a05b15c145fbe8d4e8f}{error}(i18n(\textcolor{stringliteral}{"Okular could not locate the program 'dvips' on your computer. That program is "}
253                     \textcolor{stringliteral}{"essential for the export function to work.\(\backslash\)n"}
254                     \textcolor{stringliteral}{"Hint to the perplexed system administrator: Okular uses the PATH environment variable 
      "}
255                     \textcolor{stringliteral}{"when looking for programs."}), -1);
256     \textcolor{keywordflow}{return};
257   \}
258 
259   \textcolor{keywordflow}{if} (!output\_name.isEmpty()) \{
260     output\_name\_ = output\_name;
261 
262   \} \textcolor{keywordflow}{else} \{
263     \textcolor{comment}{// Generate a suggestion for a reasonable file name}
264     \textcolor{keyword}{const} QString suggested\_name = dvi.\hyperlink{classdvifile_a1c0fe420231e71f256b5db367b7e1178}{filename}.left(dvi.\hyperlink{classdvifile_a1c0fe420231e71f256b5db367b7e1178}{filename}.indexOf(\textcolor{stringliteral}{"."})) + \textcolor{stringliteral}{".ps"};
265     output\_name\_ = KFileDialog::getSaveFileName(suggested\_name, i18n(\textcolor{stringliteral}{"*.ps|PostScript (*.ps)"}), 
      parent\_widget, i18n(\textcolor{stringliteral}{"Export File As"}));
266     \textcolor{keywordflow}{if} (output\_name\_.isEmpty())
267       \textcolor{keywordflow}{return};
268 
269     \textcolor{keyword}{const} QFileInfo output(output\_name\_);
270     \textcolor{keywordflow}{if} (!output.exists()) \{
271       \textcolor{keyword}{const} \textcolor{keywordtype}{int} result =
272         KMessageBox::warningContinueCancel(parent\_widget,
273                                            i18n(\textcolor{stringliteral}{"The file %1\(\backslash\)nexists. Do you want to overwrite it?"}, 
      output\_name\_),
274                                            i18n(\textcolor{stringliteral}{"Overwrite File"}),
275                                            KGuiItem( i18n(\textcolor{stringliteral}{"Overwrite"}) ));
276       \textcolor{keywordflow}{if} (result == KMessageBox::Cancel)
277         \textcolor{keywordflow}{return};
278     \}
279   \}
280 
281   \textcolor{comment}{// There is a major problem with dvips, at least 5.86 and lower: the}
282   \textcolor{comment}{// arguments of the option "-pp" refer to TeX-pages, not to}
283   \textcolor{comment}{// sequentially numbered pages. For instance "-pp 7" may refer to 3}
284   \textcolor{comment}{// or more pages: one page "VII" in the table of contents, a page}
285   \textcolor{comment}{// "7" in the text body, and any number of pages "7" in various}
286   \textcolor{comment}{// appendices, indices, bibliographies, and so forth. KDVI currently}
287   \textcolor{comment}{// uses the following disgusting workaround: if the "options"}
288   \textcolor{comment}{// variable is used, the DVI-file is copied to a temporary file, and}
289   \textcolor{comment}{// all the page numbers are changed into a sequential ordering}
290   \textcolor{comment}{// (using UNIX files, and taking manually care of CPU byte}
291   \textcolor{comment}{// ordering). Finally, dvips is then called with the new file, and}
292   \textcolor{comment}{// the file is afterwards deleted. Isn't that great?}
293 
294   \textcolor{comment}{// A similar problem occurs with DVI files that contain page size}
295   \textcolor{comment}{// information. On these files, dvips pointblank refuses to change}
296   \textcolor{comment}{// the page orientation or set another page size. Thus, if the}
297   \textcolor{comment}{// DVI-file does contain page size information, we remove that}
298   \textcolor{comment}{// information first.}
299 
300   \textcolor{comment}{// input\_name is the name of the DVI which is used by dvips, either}
301   \textcolor{comment}{// the original file, or a temporary file with a new numbering.}
302   QString input\_name = dvi.\hyperlink{classdvifile_a1c0fe420231e71f256b5db367b7e1178}{filename};
303   \textcolor{keywordflow}{if} (!options.isEmpty() || dvi.\hyperlink{classdvifile_a9fdbeee20bb39fcafe317925767b24ef}{suggestedPageSize} != 0) \{
304     \textcolor{comment}{// Get a name for a temporary file.}
305     \textcolor{comment}{// Must open the QTemporaryFile to access the name.}
306     KTemporaryFile tmpfile;
307     tmpfile.setAutoRemove(\textcolor{keyword}{false});
308     tmpfile.open();
309     tmpfile\_name\_ = tmpfile.fileName();
310     tmpfile.close();
311 
312     input\_name = tmpfile\_name\_;
313 
314     \hyperlink{classfontPool}{fontPool} fp(useFontHinting);
315     \hyperlink{classdvifile}{dvifile} newFile(&dvi, &fp);
316 
317     \textcolor{comment}{// Renumber pages}
318     newFile.renumber();
319 
320     \textcolor{keyword}{const} quint16 saved\_current\_page = parent.current\_page;
321     \hyperlink{classdvifile}{dvifile}* saved\_dvi = parent.\hyperlink{classdviRenderer_a67ded13a1a8da343aa0ee921ed96d4c2}{dviFile};
322     parent.\hyperlink{classdviRenderer_a67ded13a1a8da343aa0ee921ed96d4c2}{dviFile} = &newFile;
323     parent.errorMsg = QString();
324 
325     \textcolor{comment}{// Remove any page size information from the file}
326     \textcolor{keywordflow}{for} (parent.current\_page = 0;
327         parent.current\_page < newFile.total\_pages;
328         parent.current\_page++)
329     \{
330       \textcolor{keywordflow}{if} (parent.current\_page < newFile.total\_pages) \{
331         parent.\hyperlink{classbigEndianByteReader_aa8919f6fe116fd3230337675fd23abac}{command\_pointer} =
332           newFile.dvi\_Data() + parent.\hyperlink{classdviRenderer_a67ded13a1a8da343aa0ee921ed96d4c2}{dviFile}->\hyperlink{classdvifile_aeafc97277647ad5077a774be71b3253a}{page\_offset}[int(parent.current\_page)];
333         parent.\hyperlink{classbigEndianByteReader_ace2790221530572c87c58f1f77924beb}{end\_pointer} =
334           newFile.dvi\_Data() + parent.\hyperlink{classdviRenderer_a67ded13a1a8da343aa0ee921ed96d4c2}{dviFile}->\hyperlink{classdvifile_aeafc97277647ad5077a774be71b3253a}{page\_offset}[int(parent.current\_page+1)];
335       \} \textcolor{keywordflow}{else} \{
336         parent.\hyperlink{classbigEndianByteReader_aa8919f6fe116fd3230337675fd23abac}{command\_pointer} = 0;
337         parent.\hyperlink{classbigEndianByteReader_ace2790221530572c87c58f1f77924beb}{end\_pointer} = 0;
338       \}
339 
340       memset((\textcolor{keywordtype}{char}*) &parent.currinf.\hyperlink{structdrawinf_af73f66288002f0a25c7843a534bf1340}{data}, 0, \textcolor{keyword}{sizeof}(parent.currinf.\hyperlink{structdrawinf_af73f66288002f0a25c7843a534bf1340}{data}));
341       parent.currinf.\hyperlink{structdrawinf_ac68bb33a017c34bf63f8dce71ad3ef17}{fonttable} = &(parent.\hyperlink{classdviRenderer_a67ded13a1a8da343aa0ee921ed96d4c2}{dviFile}->\hyperlink{classdvifile_a05cb283609e6d1627940d14e8fc85b62}{tn\_table});
342       parent.currinf.\hyperlink{structdrawinf_a9fef874e701c25d0d781612bd3f615a5}{\_virtual}  = 0;
343       parent.prescan(&dviRenderer::prescan\_removePageSizeInfo);
344     \}
345 
346     parent.current\_page = saved\_current\_page;
347     parent.\hyperlink{classdviRenderer_a67ded13a1a8da343aa0ee921ed96d4c2}{dviFile} = saved\_dvi;
348     newFile.\hyperlink{classdvifile_a35300cbcea8a976384273a40b11d704f}{saveAs}(input\_name);
349   \}
350 
351   \hyperlink{classDVIExport_a2ebb3589d91eea01fa9a56e6fd1b6aa8}{initialise\_progress\_dialog}(dvi.\hyperlink{classdvifile_a71577dbd82a462b855abc96be3b369c5}{total\_pages},
352                              i18n(\textcolor{stringliteral}{"Using dvips to export the file to PostScript"}),
353                              i18n(\textcolor{stringliteral}{"Okular is currently using the external program 'dvips' to "}
354                                   \textcolor{stringliteral}{"convert your DVI-file to PostScript. Sometimes that can take "}
355                                   \textcolor{stringliteral}{"a while because dvips needs to generate its own bitmap fonts "}
356                                   \textcolor{stringliteral}{"Please be patient."}),
357                              i18n(\textcolor{stringliteral}{"Waiting for dvips to finish..."}) );
358 
359   QStringList args;
360   \textcolor{keywordflow}{if} (!printer)
361     \textcolor{comment}{// Export hyperlinks}
362     args << \textcolor{stringliteral}{"-z"};
363 
364   \textcolor{keywordflow}{if} (!options.isEmpty())
365     args += options;
366 
367   args << input\_name
368        << \textcolor{stringliteral}{"-o"}
369        << output\_name\_;
370 
371   \hyperlink{classDVIExport_a3c0314e24108c630ce50b42d2ecfbcce}{start}(\textcolor{stringliteral}{"dvips"},
372         args,
373         QFileInfo(dvi.\hyperlink{classdvifile_a1c0fe420231e71f256b5db367b7e1178}{filename}).absolutePath(),
374         i18n(\textcolor{stringliteral}{"<qt>The external program 'dvips', which was used to export the file, reported an error. "}
375              \textcolor{stringliteral}{"You might wish to look at the <strong>document info dialog</strong> which you will "}
376              \textcolor{stringliteral}{"find in the File-Menu for a precise error report.</qt>"}));
377 \}
\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
generators/dvi/\hyperlink{dviexport_8h}{dviexport.\+h}\item 
generators/dvi/\hyperlink{dviexport_8cpp}{dviexport.\+cpp}\end{DoxyCompactItemize}
