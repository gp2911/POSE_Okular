\hypertarget{unpluck_8cpp}{\section{generators/plucker/unpluck/unpluck.cpp File Reference}
\label{unpluck_8cpp}\index{generators/plucker/unpluck/unpluck.\+cpp@{generators/plucker/unpluck/unpluck.\+cpp}}
}
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$zlib.\+h$>$}\\*
{\ttfamily \#include \char`\"{}unpluck.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}unpluckint.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$ \hyperlink{unpluck_8cpp_a663a4e5c393266cbb1cfd41c46b57616}{plkr\+\_\+\+Open\+Doc} (\hyperlink{unpluck_8h_a74fbfe35b87f9a4c762e6a099cb849d5}{plkr\+\_\+\+D\+B\+Handle} handle)
\item 
int \hyperlink{unpluck_8cpp_ad72da860facf37f9ac7b14eedc1d7d77}{plkr\+\_\+\+Get\+Uid\+For\+Index} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc, int record\+\_\+index)
\item 
void \hyperlink{unpluck_8cpp_a22eef807fefa1151ce30759bd0b657fe}{plkr\+\_\+\+Close\+Doc} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$ \hyperlink{unpluck_8cpp_a38de1e8e97b764ccca414cf11e08dc61}{plkr\+\_\+\+Open\+D\+B\+File} (char $\ast$filename)
\item 
int \hyperlink{unpluck_8cpp_a00b78f47cb6e1d317ae13ffe52cc2812}{plkr\+\_\+\+Copy\+Record\+Bytes} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc, int record\+\_\+index, unsigned char $\ast$output\+\_\+buffer, int output\+\_\+buffer\+\_\+size, \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4}{plkr\+\_\+\+Data\+Record\+Type} $\ast$type)
\item 
unsigned char $\ast$ \hyperlink{unpluck_8cpp_adbedc945ce6c9be1f34fd5cd770a3b24}{plkr\+\_\+\+Get\+Record\+Bytes} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc, int record\+\_\+index, int $\ast$\hyperlink{synctex__parser_8c_aa23c661441688350614bd6a350d2b6ff}{size}, \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4}{plkr\+\_\+\+Data\+Record\+Type} $\ast$type)
\item 
int \hyperlink{unpluck_8cpp_a8b6f0c5a537f337b35883623bb57a903}{plkr\+\_\+\+Get\+Home\+Record\+I\+D} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
char $\ast$ \hyperlink{unpluck_8cpp_adb65e4c54851ce85120ea90c26b07fe7}{plkr\+\_\+\+Get\+Name} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
char $\ast$ \hyperlink{unpluck_8cpp_a8d84299a17aad8c4bb6d4767010fbf08}{plkr\+\_\+\+Get\+Title} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
char $\ast$ \hyperlink{unpluck_8cpp_a45d4ff9de35c9fe8a8e36760e71a9992}{plkr\+\_\+\+Get\+Author} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
int \hyperlink{unpluck_8cpp_addde9712278eba9ef0436a492df61356}{plkr\+\_\+\+Get\+Default\+Charset} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
unsigned long \hyperlink{unpluck_8cpp_a4531d6236359aa5e52b27032285d86e1}{plkr\+\_\+\+Get\+Publication\+Time} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
\hyperlink{unpluck_8h_a705714ac742bd9800de81b487a71de96}{plkr\+\_\+\+Category\+List} \hyperlink{unpluck_8cpp_a7204bd25650452edb8c46514f948591c}{plkr\+\_\+\+Get\+Default\+Categories} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
int \hyperlink{unpluck_8cpp_a491631322face4b090e9648f6e8f4e88}{plkr\+\_\+\+Get\+Record\+Count} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
int \hyperlink{unpluck_8cpp_ae7e5f8085ac4760c823e8879cac2871b}{plkr\+\_\+\+Get\+Max\+Record\+Size} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc)
\item 
char $\ast$ \hyperlink{unpluck_8cpp_ae37d2555b9ac501e2c496c96774c66c8}{plkr\+\_\+\+Get\+Record\+U\+R\+L} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc, int record\+\_\+index)
\item 
int \hyperlink{unpluck_8cpp_a9f77cae4c6de4a1bc2fa96004dab89bc}{plkr\+\_\+\+Has\+Record\+With\+I\+D} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc, int record\+\_\+index)
\item 
int \hyperlink{unpluck_8cpp_a00c3ad2c6137b26126ccbceaf4a32bed}{plkr\+\_\+\+Get\+Record\+Type} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc, int record\+\_\+index)
\item 
int \hyperlink{unpluck_8cpp_ad77c7aff05534016bb1d66be952737c7}{plkr\+\_\+\+Get\+Record\+Charset} (\hyperlink{unpluck_8h_a693dc907f8df7998a38f41a4e3512e2c}{plkr\+\_\+\+Document} $\ast$doc, int record\+\_\+index)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{unpluck_8cpp_a22eef807fefa1151ce30759bd0b657fe}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Close\+Doc@{plkr\+\_\+\+Close\+Doc}}
\index{plkr\+\_\+\+Close\+Doc@{plkr\+\_\+\+Close\+Doc}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Close\+Doc}]{\setlength{\rightskip}{0pt plus 5cm}void plkr\+\_\+\+Close\+Doc (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a22eef807fefa1151ce30759bd0b657fe}


Definition at line 879 of file unpluck.\+cpp.


\begin{DoxyCode}
882 \{
883     \textcolor{keywordflow}{if} (doc == NULL) \{
884         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Attempt to free NULL doc"});
885     \}
886     \textcolor{keywordflow}{else} \{
887         FreePluckerDoc (doc);
888     \}
889 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a00b78f47cb6e1d317ae13ffe52cc2812}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Copy\+Record\+Bytes@{plkr\+\_\+\+Copy\+Record\+Bytes}}
\index{plkr\+\_\+\+Copy\+Record\+Bytes@{plkr\+\_\+\+Copy\+Record\+Bytes}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Copy\+Record\+Bytes}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Copy\+Record\+Bytes (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc, }
\item[{int}]{record\+\_\+index, }
\item[{unsigned char $\ast$}]{output\+\_\+buffer, }
\item[{int}]{output\+\_\+buffer\+\_\+size, }
\item[{{\bf plkr\+\_\+\+Data\+Record\+Type} $\ast$}]{type}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a00b78f47cb6e1d317ae13ffe52cc2812}


Definition at line 1003 of file unpluck.\+cpp.


\begin{DoxyCode}
1009   \{
1010     \hyperlink{structplkr__DataRecord__s}{plkr\_DataRecord}*  record;
1011     \textcolor{keywordtype}{int}               output\_size;
1012 
1013     \textcolor{keywordflow}{if} (!FindRecordByIndex (doc, record\_index))
1014         \textcolor{keywordflow}{return} 0;
1015 
1016     \textcolor{keywordflow}{if} (!GetUncompressedRecord (doc, doc->\hyperlink{structplkr__Document__s_ae1a048bf4797c696d6313c1e08ce3577}{handle}, record\_index,
1017                                 output\_buffer, output\_buffer\_size,
1018                                 \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4ac35262788e05b005a46ee8154a7a6a7b}{PLKR\_DRTYPE\_NONE}, NULL, &output\_size,
1019                                 &record))
1020         \textcolor{keywordflow}{return} 0;
1021     \textcolor{keywordflow}{else} \{
1022         *type = record->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type};
1023         \textcolor{keywordflow}{return} output\_size;
1024     \}
1025 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a45d4ff9de35c9fe8a8e36760e71a9992}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Author@{plkr\+\_\+\+Get\+Author}}
\index{plkr\+\_\+\+Get\+Author@{plkr\+\_\+\+Get\+Author}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Author}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ plkr\+\_\+\+Get\+Author (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a45d4ff9de35c9fe8a8e36760e71a9992}


Definition at line 1080 of file unpluck.\+cpp.


\begin{DoxyCode}
1083 \{
1084     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_a8347ae3e4ab58977de561cdc2877b93f}{author};
1085 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a7204bd25650452edb8c46514f948591c}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Default\+Categories@{plkr\+\_\+\+Get\+Default\+Categories}}
\index{plkr\+\_\+\+Get\+Default\+Categories@{plkr\+\_\+\+Get\+Default\+Categories}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Default\+Categories}]{\setlength{\rightskip}{0pt plus 5cm}{\bf plkr\+\_\+\+Category\+List} plkr\+\_\+\+Get\+Default\+Categories (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a7204bd25650452edb8c46514f948591c}


Definition at line 1107 of file unpluck.\+cpp.


\begin{DoxyCode}
1110 \{
1111     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_a2f029383d0943d3be079d88a3dccf8f3}{default\_categories};
1112 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_addde9712278eba9ef0436a492df61356}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Default\+Charset@{plkr\+\_\+\+Get\+Default\+Charset}}
\index{plkr\+\_\+\+Get\+Default\+Charset@{plkr\+\_\+\+Get\+Default\+Charset}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Default\+Charset}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Get\+Default\+Charset (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_addde9712278eba9ef0436a492df61356}


Definition at line 1088 of file unpluck.\+cpp.


\begin{DoxyCode}
1091 \{
1092     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_a588365c6be19fc1264b2549aed61d9d0}{default\_charset\_mibenum};
1093 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a8b6f0c5a537f337b35883623bb57a903}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Home\+Record\+I\+D@{plkr\+\_\+\+Get\+Home\+Record\+I\+D}}
\index{plkr\+\_\+\+Get\+Home\+Record\+I\+D@{plkr\+\_\+\+Get\+Home\+Record\+I\+D}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Home\+Record\+I\+D}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Get\+Home\+Record\+I\+D (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a8b6f0c5a537f337b35883623bb57a903}


Definition at line 1056 of file unpluck.\+cpp.


\begin{DoxyCode}
1059 \{
1060     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_a855d2555348d33aa63c23324fca29775}{home\_record\_uid};
1061 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_ae7e5f8085ac4760c823e8879cac2871b}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Max\+Record\+Size@{plkr\+\_\+\+Get\+Max\+Record\+Size}}
\index{plkr\+\_\+\+Get\+Max\+Record\+Size@{plkr\+\_\+\+Get\+Max\+Record\+Size}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Max\+Record\+Size}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Get\+Max\+Record\+Size (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_ae7e5f8085ac4760c823e8879cac2871b}


Definition at line 1123 of file unpluck.\+cpp.


\begin{DoxyCode}
1126 \{
1127     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_af5e11a562c37e9684e4930b776170f85}{max\_record\_size};
1128 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_adb65e4c54851ce85120ea90c26b07fe7}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Name@{plkr\+\_\+\+Get\+Name}}
\index{plkr\+\_\+\+Get\+Name@{plkr\+\_\+\+Get\+Name}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Name}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ plkr\+\_\+\+Get\+Name (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_adb65e4c54851ce85120ea90c26b07fe7}


Definition at line 1064 of file unpluck.\+cpp.


\begin{DoxyCode}
1067 \{
1068     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_a40733c5478612b5565a4e0155a01bdc6}{name};
1069 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a4531d6236359aa5e52b27032285d86e1}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Publication\+Time@{plkr\+\_\+\+Get\+Publication\+Time}}
\index{plkr\+\_\+\+Get\+Publication\+Time@{plkr\+\_\+\+Get\+Publication\+Time}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Publication\+Time}]{\setlength{\rightskip}{0pt plus 5cm}unsigned long plkr\+\_\+\+Get\+Publication\+Time (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a4531d6236359aa5e52b27032285d86e1}


Definition at line 1096 of file unpluck.\+cpp.


\begin{DoxyCode}
1099 \{
1100     \textcolor{keywordflow}{if} (doc->\hyperlink{structplkr__Document__s_a29ac543a7a36087e946457ff8709517b}{publication\_time})
1101         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}) doc->\hyperlink{structplkr__Document__s_a29ac543a7a36087e946457ff8709517b}{publication\_time};
1102     \textcolor{keywordflow}{else}
1103         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}) doc->\hyperlink{structplkr__Document__s_a0c43dd82cb77cbf9f5d879e521e1d4ee}{creation\_time};
1104 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_adbedc945ce6c9be1f34fd5cd770a3b24}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Record\+Bytes@{plkr\+\_\+\+Get\+Record\+Bytes}}
\index{plkr\+\_\+\+Get\+Record\+Bytes@{plkr\+\_\+\+Get\+Record\+Bytes}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Record\+Bytes}]{\setlength{\rightskip}{0pt plus 5cm}unsigned char$\ast$ plkr\+\_\+\+Get\+Record\+Bytes (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc, }
\item[{int}]{record\+\_\+index, }
\item[{int $\ast$}]{size, }
\item[{{\bf plkr\+\_\+\+Data\+Record\+Type} $\ast$}]{type}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_adbedc945ce6c9be1f34fd5cd770a3b24}


Definition at line 1029 of file unpluck.\+cpp.


\begin{DoxyCode}
1034   \{
1035     \hyperlink{structplkr__DataRecord__s}{plkr\_DataRecord}*  record;
1036     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*    buf;
1037 
1038     \textcolor{keywordflow}{if} (!FindRecordByIndex (doc, record\_index))
1039         \textcolor{keywordflow}{return} NULL;
1040 
1041     \textcolor{keywordflow}{if} (!GetUncompressedRecord (doc, doc->\hyperlink{structplkr__Document__s_ae1a048bf4797c696d6313c1e08ce3577}{handle}, record\_index,
1042                                 NULL, 0, \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4ac35262788e05b005a46ee8154a7a6a7b}{PLKR\_DRTYPE\_NONE},
1043                                 &buf, \hyperlink{synctex__parser_8c_aa23c661441688350614bd6a350d2b6ff}{size}, &record))
1044         \textcolor{keywordflow}{return} NULL;
1045     \textcolor{keywordflow}{else} \{
1046         \textcolor{keywordflow}{if} (!record->\hyperlink{structplkr__DataRecord__s_af2a33cffa3aff9f346678b89727beb52}{cache}) \{
1047             record->\hyperlink{structplkr__DataRecord__s_af2a33cffa3aff9f346678b89727beb52}{cache} = buf;
1048             record->\hyperlink{structplkr__DataRecord__s_a78134dc5aa0e23c86e5299ea6ca9f4b2}{cached\_size} = *\hyperlink{synctex__parser_8c_aa23c661441688350614bd6a350d2b6ff}{size};
1049         \}
1050         *type = record->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type};
1051         \textcolor{keywordflow}{return} buf;
1052     \}
1053 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_ad77c7aff05534016bb1d66be952737c7}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Record\+Charset@{plkr\+\_\+\+Get\+Record\+Charset}}
\index{plkr\+\_\+\+Get\+Record\+Charset@{plkr\+\_\+\+Get\+Record\+Charset}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Record\+Charset}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Get\+Record\+Charset (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc, }
\item[{int}]{record\+\_\+index}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_ad77c7aff05534016bb1d66be952737c7}


Definition at line 1167 of file unpluck.\+cpp.


\begin{DoxyCode}
1171 \{
1172     \hyperlink{structplkr__DataRecord__s}{plkr\_DataRecord}*  r;
1173 
1174     r = FindRecordByIndex (doc, record\_index);
1175     \textcolor{keywordflow}{if} (r && ((r->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type} == \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4a2a7d1fcd3aee05f31ab3dae95e80786c}{PLKR\_DRTYPE\_TEXT\_COMPRESSED})
1176               || (r->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type} == \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4a571c71bbb146f2641a43d28fd0fa2d72}{PLKR\_DRTYPE\_TEXT}))) \{
1177         \textcolor{keywordflow}{if} (r->\hyperlink{structplkr__DataRecord__s_aeb1516d92695e1a446bef9e5385a0b72}{charset\_mibenum} == 0)
1178             \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_a588365c6be19fc1264b2549aed61d9d0}{default\_charset\_mibenum};
1179         \textcolor{keywordflow}{else}
1180             \textcolor{keywordflow}{return} r->\hyperlink{structplkr__DataRecord__s_aeb1516d92695e1a446bef9e5385a0b72}{charset\_mibenum};
1181     \}
1182     \textcolor{keywordflow}{else}
1183         \textcolor{keywordflow}{return} 0;
1184 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a491631322face4b090e9648f6e8f4e88}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Record\+Count@{plkr\+\_\+\+Get\+Record\+Count}}
\index{plkr\+\_\+\+Get\+Record\+Count@{plkr\+\_\+\+Get\+Record\+Count}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Record\+Count}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Get\+Record\+Count (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a491631322face4b090e9648f6e8f4e88}


Definition at line 1115 of file unpluck.\+cpp.


\begin{DoxyCode}
1118 \{
1119     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_a133abbdd399b433991b5e561339990f7}{nrecords};
1120 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a00c3ad2c6137b26126ccbceaf4a32bed}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Record\+Type@{plkr\+\_\+\+Get\+Record\+Type}}
\index{plkr\+\_\+\+Get\+Record\+Type@{plkr\+\_\+\+Get\+Record\+Type}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Record\+Type}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Get\+Record\+Type (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc, }
\item[{int}]{record\+\_\+index}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a00c3ad2c6137b26126ccbceaf4a32bed}


Definition at line 1152 of file unpluck.\+cpp.


\begin{DoxyCode}
1156 \{
1157     \hyperlink{structplkr__DataRecord__s}{plkr\_DataRecord}*  r;
1158 
1159     r = FindRecordByIndex (doc, record\_index);
1160     \textcolor{keywordflow}{if} (r)
1161         \textcolor{keywordflow}{return} r->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type};
1162     \textcolor{keywordflow}{else}
1163         \textcolor{keywordflow}{return} \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4ac35262788e05b005a46ee8154a7a6a7b}{PLKR\_DRTYPE\_NONE};
1164 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_ae37d2555b9ac501e2c496c96774c66c8}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Record\+U\+R\+L@{plkr\+\_\+\+Get\+Record\+U\+R\+L}}
\index{plkr\+\_\+\+Get\+Record\+U\+R\+L@{plkr\+\_\+\+Get\+Record\+U\+R\+L}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Record\+U\+R\+L}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ plkr\+\_\+\+Get\+Record\+U\+R\+L (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc, }
\item[{int}]{record\+\_\+index}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_ae37d2555b9ac501e2c496c96774c66c8}


Definition at line 1131 of file unpluck.\+cpp.


\begin{DoxyCode}
1135 \{
1136     \textcolor{keywordflow}{if} (record\_index < 1 || record\_index > doc->\hyperlink{structplkr__Document__s_a9ed11d122b2fe4b200fb727486501041}{nurls})
1137         \textcolor{keywordflow}{return} NULL;
1138     \textcolor{keywordflow}{else}
1139         \textcolor{keywordflow}{return} (doc->\hyperlink{structplkr__Document__s_a5ada88486c1d6db75aafd17b23fe17db}{urls}[record\_index - 1]);
1140 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a8d84299a17aad8c4bb6d4767010fbf08}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Title@{plkr\+\_\+\+Get\+Title}}
\index{plkr\+\_\+\+Get\+Title@{plkr\+\_\+\+Get\+Title}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Title}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ plkr\+\_\+\+Get\+Title (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a8d84299a17aad8c4bb6d4767010fbf08}


Definition at line 1072 of file unpluck.\+cpp.


\begin{DoxyCode}
1075 \{
1076     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_ab71be4337a9081768a49c7a0849469c7}{title};
1077 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_ad72da860facf37f9ac7b14eedc1d7d77}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Get\+Uid\+For\+Index@{plkr\+\_\+\+Get\+Uid\+For\+Index}}
\index{plkr\+\_\+\+Get\+Uid\+For\+Index@{plkr\+\_\+\+Get\+Uid\+For\+Index}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Get\+Uid\+For\+Index}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Get\+Uid\+For\+Index (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc, }
\item[{int}]{record\+\_\+index}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_ad72da860facf37f9ac7b14eedc1d7d77}


Definition at line 870 of file unpluck.\+cpp.


\begin{DoxyCode}
874 \{
875     \textcolor{keywordflow}{return} doc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[ record\_index ].\hyperlink{structplkr__DataRecord__s_afd7b53eef587427617f90ec51d69fbeb}{uid};
876 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a9f77cae4c6de4a1bc2fa96004dab89bc}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Has\+Record\+With\+I\+D@{plkr\+\_\+\+Has\+Record\+With\+I\+D}}
\index{plkr\+\_\+\+Has\+Record\+With\+I\+D@{plkr\+\_\+\+Has\+Record\+With\+I\+D}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Has\+Record\+With\+I\+D}]{\setlength{\rightskip}{0pt plus 5cm}int plkr\+\_\+\+Has\+Record\+With\+I\+D (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+Document} $\ast$}]{doc, }
\item[{int}]{record\+\_\+index}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a9f77cae4c6de4a1bc2fa96004dab89bc}


Definition at line 1143 of file unpluck.\+cpp.


\begin{DoxyCode}
1147 \{
1148     \textcolor{keywordflow}{return} (FindRecordByIndex (doc, record\_index) != NULL);
1149 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a38de1e8e97b764ccca414cf11e08dc61}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Open\+D\+B\+File@{plkr\+\_\+\+Open\+D\+B\+File}}
\index{plkr\+\_\+\+Open\+D\+B\+File@{plkr\+\_\+\+Open\+D\+B\+File}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Open\+D\+B\+File}]{\setlength{\rightskip}{0pt plus 5cm}{\bf plkr\+\_\+\+Document}$\ast$ plkr\+\_\+\+Open\+D\+B\+File (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{filename}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a38de1e8e97b764ccca414cf11e08dc61}


Definition at line 965 of file unpluck.\+cpp.


\begin{DoxyCode}
968 \{
969     \hyperlink{structplkr__DBHandle__s}{plkr\_DBHandle}   handle;
970     \hyperlink{structplkr__Document__s}{plkr\_Document}*  doc;
971     \textcolor{keywordtype}{int}             fp;
972 
973 \textcolor{preprocessor}{#if !defined(WIN32)}
974     fp = open (filename, O\_RDONLY);
975 \textcolor{preprocessor}{#else}
976     fp = open (filename, O\_RDONLY | O\_BINARY);
977 \textcolor{preprocessor}{#endif}
978     \textcolor{keywordflow}{if} (fp < 0) \{
979         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Can't open file %s"}, filename);
980         \textcolor{keywordflow}{return} NULL;
981     \}
982     handle = (\hyperlink{unpluck_8h_a74fbfe35b87f9a4c762e6a099cb849d5}{plkr\_DBHandle}) malloc (\textcolor{keyword}{sizeof} (*handle));
983     handle->\hyperlink{structplkr__DBHandle__s_a8524d7cbaf5756ba6af798cbfa84e77f}{dbprivate} = fp;
984     handle->\hyperlink{structplkr__DBHandle__s_aca1e04dbcb61b099a145d7771c951fa2}{seek} = FpSeek;
985     handle->\hyperlink{structplkr__DBHandle__s_a0ab0715537eb77ede37a911b6593be9d}{read} = FpRead;
986     handle->\hyperlink{structplkr__DBHandle__s_a5040a81f7438fbb5a987e825a3e3df63}{free} = FpFree;
987     handle->\hyperlink{structplkr__DBHandle__s_abbdac090fcc71fa8fc750ae06f442776}{size} = FpSize;
988     doc = \hyperlink{unpluck_8cpp_a663a4e5c393266cbb1cfd41c46b57616}{plkr\_OpenDoc} (handle);
989     \textcolor{keywordflow}{if} (doc == NULL)
990         close (fp);
991     \textcolor{keywordflow}{return} doc;
992 \}
\end{DoxyCode}
\hypertarget{unpluck_8cpp_a663a4e5c393266cbb1cfd41c46b57616}{\index{unpluck.\+cpp@{unpluck.\+cpp}!plkr\+\_\+\+Open\+Doc@{plkr\+\_\+\+Open\+Doc}}
\index{plkr\+\_\+\+Open\+Doc@{plkr\+\_\+\+Open\+Doc}!unpluck.\+cpp@{unpluck.\+cpp}}
\subsubsection[{plkr\+\_\+\+Open\+Doc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf plkr\+\_\+\+Document}$\ast$ plkr\+\_\+\+Open\+Doc (
\begin{DoxyParamCaption}
\item[{{\bf plkr\+\_\+\+D\+B\+Handle}}]{handle}
\end{DoxyParamCaption}
)}}\label{unpluck_8cpp_a663a4e5c393266cbb1cfd41c46b57616}


Definition at line 623 of file unpluck.\+cpp.


\begin{DoxyCode}
626 \{
627     \hyperlink{structReservedRecordEntry}{ReservedRecordEntry}  reserved[\hyperlink{unpluckint_8h_aa0b0779992ee63e5b90b143aaa2dcc01}{MAX\_RESERVED}];
628     \hyperlink{structplkr__DataRecord__s}{plkr\_DataRecord}*     record;
629     \hyperlink{structplkr__Document__s}{plkr\_Document}*       newdoc;
630     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}        utilbuf[128];
631     \textcolor{keyword}{static} \textcolor{keywordtype}{char}          id\_stamp[9] = \textcolor{stringliteral}{"DataPlkr"};
632     \textcolor{keywordtype}{int}                  i;
633     \textcolor{keywordtype}{int}                  nreserved;
634     \textcolor{keywordtype}{int}                  records\_size;
635     \textcolor{keywordtype}{int}                  compression;
636 
637 
638     \textcolor{keywordflow}{if} (!handle->\hyperlink{structplkr__DBHandle__s_aca1e04dbcb61b099a145d7771c951fa2}{seek} (handle, 0) ||
639         (handle->\hyperlink{structplkr__DBHandle__s_a0ab0715537eb77ede37a911b6593be9d}{read} (handle, utilbuf, \textcolor{keyword}{sizeof} (utilbuf), 78) != 78)) \{
640         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Bad read of DB header"});
641         \textcolor{keywordflow}{return} NULL;
642     \}
643 
644     \textcolor{comment}{/* check for type stamp */}
645     \textcolor{keywordflow}{if} (strncmp ((\textcolor{keywordtype}{char} *) (utilbuf + 60), id\_stamp, 8) != 0) \{
646         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Bad magic number"});
647         \textcolor{keywordflow}{return} NULL;
648     \}
649 
650     \textcolor{comment}{/* check for version 1 */}
651     i = (utilbuf[34] << 8) + utilbuf[35];
652     \textcolor{keywordflow}{if} (i != 1) \{
653         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Not version 1 of Plucker format; version %d"}, i);
654         \textcolor{keywordflow}{return} NULL;
655     \}
656 
657     \textcolor{comment}{/* get the title, creation time, and last modification time from header */}
658     newdoc = (\hyperlink{structplkr__Document__s}{plkr\_Document} *) malloc (\textcolor{keyword}{sizeof} (\hyperlink{structplkr__Document__s}{plkr\_Document}));
659     memset (newdoc, 0, \textcolor{keyword}{sizeof} (\hyperlink{structplkr__Document__s}{plkr\_Document}));
660     newdoc->\hyperlink{structplkr__Document__s_a40733c5478612b5565a4e0155a01bdc6}{name} = (\textcolor{keywordtype}{char}*)\hyperlink{unpluckint_8h_a1be042165603e16fc2aacd92929321e1}{\_plkr\_strndup} ((\textcolor{keywordtype}{char}*)utilbuf, \hyperlink{unpluckint_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN} (strlen ((\textcolor{keywordtype}{char}*)utilbuf), 
      32));
661     newdoc->\hyperlink{structplkr__Document__s_a0c43dd82cb77cbf9f5d879e521e1d4ee}{creation\_time} = (time\_t) ((utilbuf[36] << 24) +
662                                       (utilbuf[37] << 16) +
663                                       (utilbuf[38] << 8) +
664                                       utilbuf[39] - \hyperlink{unpluckint_8h_a324bd288b42b2aa412811df53ca4f07d}{PLKR\_TIMEADJUST});
665     newdoc->\hyperlink{structplkr__Document__s_ab595a6fc74557f08e01385622469183f}{modification\_time} = (time\_t) ((utilbuf[40] << 24) +
666                                           (utilbuf[41] << 16) +
667                                           (utilbuf[42] << 8) +
668                                           utilbuf[43] - \hyperlink{unpluckint_8h_a324bd288b42b2aa412811df53ca4f07d}{PLKR\_TIMEADJUST});
669     newdoc->\hyperlink{structplkr__Document__s_a133abbdd399b433991b5e561339990f7}{nrecords} = (utilbuf[76] << 8) + utilbuf[77];
670 
671     \textcolor{comment}{/* Now read the record-list to find out where the records are */}
672     records\_size = \textcolor{keyword}{sizeof} (\hyperlink{unpluckint_8h_a50cfb039ab6227812a2ee8b8c105ef87}{plkr\_DataRecord}) * newdoc->\hyperlink{structplkr__Document__s_a133abbdd399b433991b5e561339990f7}{nrecords};
673     newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records} = (\hyperlink{structplkr__DataRecord__s}{plkr\_DataRecord} *) malloc (records\_size);
674     memset (newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}, 0, records\_size);
675     \textcolor{keywordflow}{for} (i = 0; i < newdoc->\hyperlink{structplkr__Document__s_a133abbdd399b433991b5e561339990f7}{nrecords}; i++) \{
676         \textcolor{keywordflow}{if} (handle->\hyperlink{structplkr__DBHandle__s_a0ab0715537eb77ede37a911b6593be9d}{read} (handle, utilbuf, sizeof (utilbuf), 8) != 8) \{
677             \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Bad read of record list"});
678             FreePluckerDoc (newdoc);
679             \textcolor{keywordflow}{return} NULL;
680         \}
681         newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[i].\hyperlink{structplkr__DataRecord__s_a913726cb8132eca067843510b8ff0b95}{offset} =
682             (utilbuf[0] << 24) + (utilbuf[1] << 16) + (utilbuf[2] << 8) +
683             utilbuf[3];
684     \}
685 
686     \textcolor{comment}{/* process the index record */}
687     \textcolor{keywordflow}{if} (!handle->\hyperlink{structplkr__DBHandle__s_aca1e04dbcb61b099a145d7771c951fa2}{seek} (handle, newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[0].\hyperlink{structplkr__DataRecord__s_a913726cb8132eca067843510b8ff0b95}{offset}) ||
688         (handle->\hyperlink{structplkr__DBHandle__s_a0ab0715537eb77ede37a911b6593be9d}{read} (handle, utilbuf, \textcolor{keyword}{sizeof} (utilbuf), 6) != 6)) \{
689         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Bad read of index record"});
690         FreePluckerDoc (newdoc);
691         \textcolor{keywordflow}{return} NULL;
692     \}
693     \textcolor{keywordflow}{if} ((utilbuf[0] << 8) + utilbuf[1] != 1) \{
694         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"index record has bad UID %d"},
695                        (utilbuf[0] << 8) + utilbuf[1]);
696         FreePluckerDoc (newdoc);
697         \textcolor{keywordflow}{return} NULL;
698     \}
699     newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[0].\hyperlink{structplkr__DataRecord__s_afd7b53eef587427617f90ec51d69fbeb}{uid} = 1;
700     compression = (utilbuf[2] << 8) + utilbuf[3];
701     \textcolor{keywordflow}{if} (compression == \hyperlink{unpluckint_8h_a75c86a2bd8e62f0c036a6389a1157ea1aaf1b8213f013aac5d019463b89300045}{PLKR\_COMPRESSION\_DOC})
702         newdoc->\hyperlink{structplkr__Document__s_aee6a7d3edd70fee86668477c05a45bd1}{compression} = \hyperlink{unpluckint_8h_a75c86a2bd8e62f0c036a6389a1157ea1aaf1b8213f013aac5d019463b89300045}{PLKR\_COMPRESSION\_DOC};
703     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (compression == \hyperlink{unpluckint_8h_a75c86a2bd8e62f0c036a6389a1157ea1ac9bc2c67365532c8641e520c4b0c0ea1}{PLKR\_COMPRESSION\_ZLIB})
704         newdoc->\hyperlink{structplkr__Document__s_aee6a7d3edd70fee86668477c05a45bd1}{compression} = \hyperlink{unpluckint_8h_a75c86a2bd8e62f0c036a6389a1157ea1ac9bc2c67365532c8641e520c4b0c0ea1}{PLKR\_COMPRESSION\_ZLIB};
705     \textcolor{keywordflow}{else} \{
706         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Unknown compression type %d"}, compression);
707         FreePluckerDoc (newdoc);
708         \textcolor{keywordflow}{return} NULL;
709     \}
710     nreserved = (utilbuf[4] << 8) + utilbuf[5];
711     \textcolor{keywordflow}{if} (nreserved > \hyperlink{unpluckint_8h_aa0b0779992ee63e5b90b143aaa2dcc01}{MAX\_RESERVED}) \{
712         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Too many reserved records (%d) for software"},
713                        nreserved);
714         FreePluckerDoc (newdoc);
715         \textcolor{keywordflow}{return} NULL;
716     \}
717     \textcolor{keywordflow}{for} (i = 0; i < nreserved; i++) \{
718         \textcolor{keywordflow}{if} (handle->\hyperlink{structplkr__DBHandle__s_a0ab0715537eb77ede37a911b6593be9d}{read} (handle, utilbuf, sizeof (utilbuf), 4) != 4) \{
719             \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Bad read of reserved record list"});
720             FreePluckerDoc (newdoc);
721             \textcolor{keywordflow}{return} NULL;
722         \}
723         reserved[i].\hyperlink{structReservedRecordEntry_a7f036e9a8868e13e35b3932178dcee00}{name} = (\hyperlink{unpluckint_8h_acd51e45c8e2b63cd1e42d5dda69c1d08}{ReservedRecordName})( (utilbuf[0] << 8) + utilbuf[1] );
724         reserved[i].\hyperlink{structReservedRecordEntry_a584205e972ca4b5f9c25b4f38eb04eae}{uid} = (utilbuf[2] << 8) + utilbuf[3];
725     \}
726 
727     \textcolor{comment}{/* OK, now process the data records */}
728     newdoc->\hyperlink{structplkr__Document__s_af5e11a562c37e9684e4930b776170f85}{max\_record\_size} = 0;
729     \textcolor{keywordflow}{for} (i = 1; i < newdoc->\hyperlink{structplkr__Document__s_a133abbdd399b433991b5e561339990f7}{nrecords}; i++) \{
730         record = newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records} + i;
731         \textcolor{keywordflow}{if} (!handle->\hyperlink{structplkr__DBHandle__s_aca1e04dbcb61b099a145d7771c951fa2}{seek} (handle, record->\hyperlink{structplkr__DataRecord__s_a913726cb8132eca067843510b8ff0b95}{offset}) ||
732             (handle->\hyperlink{structplkr__DBHandle__s_a0ab0715537eb77ede37a911b6593be9d}{read} (handle, utilbuf, \textcolor{keyword}{sizeof} (utilbuf), 8) != 8)) \{
733             \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Can't read header of record %d"}, i);
734             FreePluckerDoc (newdoc);
735             \textcolor{keywordflow}{return} NULL;
736         \}
737         newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[i - 1].\hyperlink{structplkr__DataRecord__s_ac15867fee863318b96e3f9d27a1784e6}{size} =
738             record->\hyperlink{structplkr__DataRecord__s_a913726cb8132eca067843510b8ff0b95}{offset} - newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[i - 1].\hyperlink{structplkr__DataRecord__s_a913726cb8132eca067843510b8ff0b95}{offset};
739         record->\hyperlink{structplkr__DataRecord__s_afd7b53eef587427617f90ec51d69fbeb}{uid} = (utilbuf[0] << 8) + utilbuf[1];
740         record->\hyperlink{structplkr__DataRecord__s_a13979f89593b2b7c5eff61004025cacd}{nparagraphs} = (utilbuf[2] << 8) + utilbuf[3];
741         record->\hyperlink{structplkr__DataRecord__s_a5c602d9d4b060310b9d1eda5bac08f59}{uncompressed\_size} = (utilbuf[4] << 8) + utilbuf[5];
742         record->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type} = (\hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4}{plkr\_DataRecordType})utilbuf[6];
743         newdoc->\hyperlink{structplkr__Document__s_af5e11a562c37e9684e4930b776170f85}{max\_record\_size} =
744             \hyperlink{unpluckint_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{MAX} (newdoc->\hyperlink{structplkr__Document__s_af5e11a562c37e9684e4930b776170f85}{max\_record\_size}, record->
      \hyperlink{structplkr__DataRecord__s_a5c602d9d4b060310b9d1eda5bac08f59}{uncompressed\_size});
745     \}
746     \textcolor{comment}{/* To get the size of the last record we subtract its offset from the total size of the DB. */}
747     \textcolor{keywordflow}{if} ((i = handle->\hyperlink{structplkr__DBHandle__s_abbdac090fcc71fa8fc750ae06f442776}{size} (handle)) == 0) \{
748         \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Can't obtain size of DB"});
749         FreePluckerDoc (newdoc);
750         \textcolor{keywordflow}{return} NULL;
751     \};
752     record = newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records} + (newdoc->\hyperlink{structplkr__Document__s_a133abbdd399b433991b5e561339990f7}{nrecords} - 1);
753     record->\hyperlink{structplkr__DataRecord__s_ac15867fee863318b96e3f9d27a1784e6}{size} = i - record->\hyperlink{structplkr__DataRecord__s_a913726cb8132eca067843510b8ff0b95}{offset};
754     \textcolor{comment}{/* make sure the uncompressed size is set, now that we know the record sizes */}
755     \textcolor{keywordflow}{for} (i = 0; i < newdoc->\hyperlink{structplkr__Document__s_a133abbdd399b433991b5e561339990f7}{nrecords}; i++) \{
756         record = newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records} + i;
757         \textcolor{keywordflow}{if} (record->\hyperlink{structplkr__DataRecord__s_a5c602d9d4b060310b9d1eda5bac08f59}{uncompressed\_size} == 0) \{
758             \textcolor{keywordflow}{if} (record->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type} == \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4aad8fc977517323ff1a8002971a72ac72}{PLKR\_DRTYPE\_LINKS\_COMPRESSED} ||
759                 record->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type} == \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4a2a7d1fcd3aee05f31ab3dae95e80786c}{PLKR\_DRTYPE\_TEXT\_COMPRESSED} ||
760                 record->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type} == \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4a000e69b41bb0ccfeb1e7554e7e4b5dac}{PLKR\_DRTYPE\_TABLE\_COMPRESSED} ||
761                 record->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type} == \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4afcce1912d935010a0ea86191d02dd461}{PLKR\_DRTYPE\_IMAGE\_COMPRESSED}) \{
762                 \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Bad uncompressed size 0 in record uid %d"},
763                                record->\hyperlink{structplkr__DataRecord__s_afd7b53eef587427617f90ec51d69fbeb}{uid});
764                 FreePluckerDoc (newdoc);
765                 \textcolor{keywordflow}{return} NULL;
766             \}
767             \textcolor{keywordflow}{else} \{
768                 record->\hyperlink{structplkr__DataRecord__s_a5c602d9d4b060310b9d1eda5bac08f59}{uncompressed\_size} = record->\hyperlink{structplkr__DataRecord__s_ac15867fee863318b96e3f9d27a1784e6}{size} - 8;
769             \}
770         \}
771 \textcolor{preprocessor}{#ifdef DEBUGOPEN}
772         \{
773             \textcolor{keyword}{static} \textcolor{keywordtype}{char} *types[] =
774                 \{ \textcolor{stringliteral}{"TEXT"}, \textcolor{stringliteral}{"TEXTC"}, \textcolor{stringliteral}{"IMAGE"}, \textcolor{stringliteral}{"IMAGEC"}, \textcolor{stringliteral}{"MAILTO"},
775                 \textcolor{stringliteral}{"URLINDEX"}, \textcolor{stringliteral}{"URLS"}, \textcolor{stringliteral}{"URLSC"}, \textcolor{stringliteral}{"BOOKMARKS"}, \textcolor{stringliteral}{"CATEGORIES"},
776                 \textcolor{stringliteral}{"METADATA"}
777             \};
778             \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message}
779                 (\textcolor{stringliteral}{"%3d:  type=%10s, offset=%07x, size=%5d, uncompressed\_size=%5d"},
780                  record->\hyperlink{structplkr__DataRecord__s_afd7b53eef587427617f90ec51d69fbeb}{uid},
781                  types[\hyperlink{unpluckint_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}
782                        (record->\hyperlink{structplkr__DataRecord__s_a75431a1f26dc15418437086487724ff6}{type}, sizeof (types) / \textcolor{keyword}{sizeof} (\textcolor{keywordtype}{char} *))],
783                  record->\hyperlink{structplkr__DataRecord__s_a913726cb8132eca067843510b8ff0b95}{offset}, record->\hyperlink{structplkr__DataRecord__s_ac15867fee863318b96e3f9d27a1784e6}{size}, record->
      \hyperlink{structplkr__DataRecord__s_a5c602d9d4b060310b9d1eda5bac08f59}{uncompressed\_size});
784         \}
785 \textcolor{preprocessor}{#endif}
786     \}
787 
788     \textcolor{comment}{/* find the reserved records */}
789 
790     \textcolor{comment}{/* do metadata first, to find out whether we need an owner\_id key */}
791     \textcolor{keywordflow}{for} (i = 0; i < nreserved; i++) \{
792         \textcolor{keywordflow}{if} (reserved[i].name == \hyperlink{unpluckint_8h_acd51e45c8e2b63cd1e42d5dda69c1d08a94e006cc3c975bf3074337d7c64efd83}{PLKR\_METADATA\_NAME}) \{
793             newdoc->\hyperlink{structplkr__Document__s_a19ab77ee9af9fe9a77aa06713b84a750}{metadata\_record\_uid} = reserved[i].\hyperlink{structReservedRecordEntry_a584205e972ca4b5f9c25b4f38eb04eae}{uid};
794             \textcolor{keywordflow}{if} (!ParseMetadata (newdoc, handle)) \{
795                 \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Error parsing metadata record"});
796                 FreePluckerDoc (newdoc);
797                 \textcolor{keywordflow}{return} NULL;
798             \}
799         \}
800     \}
801 
802     \textcolor{keywordflow}{if} (newdoc->\hyperlink{structplkr__Document__s_a5527d32cc4c4f3694a36fdcd96744905}{owner\_id\_required}) \{
803 
804         \textcolor{comment}{/* we need to set up the owner-id key before uncompressing}
805 \textcolor{comment}{           any records... */}
806 
807         \textcolor{keywordtype}{char} *owner\_id = \hyperlink{config_8cpp_afa8ab8d30fb9cef098abdf08fcf37151}{plkr\_GetConfigString} (NULL, \textcolor{stringliteral}{"owner\_id"}, NULL);
808 
809         \textcolor{keywordflow}{if} (owner\_id != NULL) \{
810             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} crc;
811             \textcolor{keywordtype}{int} owner\_id\_len = strlen (owner\_id);
812             crc = crc32 (0L, NULL, 0);
813             crc = crc32 (crc, (\textcolor{keyword}{const} Bytef*)owner\_id, owner\_id\_len);
814             \textcolor{keywordflow}{for} (i = 0; i < 10; i++) \{
815                 crc = crc32 (crc, (\textcolor{keyword}{const} Bytef*)owner\_id, owner\_id\_len);
816                 newdoc->\hyperlink{structplkr__Document__s_a7d7964829f29daa29f9d535723d638dc}{owner\_id\_key}[(i * 4) + 0] = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char})((crc >> 24) & 0xFF);
817                 newdoc->\hyperlink{structplkr__Document__s_a7d7964829f29daa29f9d535723d638dc}{owner\_id\_key}[(i * 4) + 1] = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char})((crc >> 16) & 0xFF);
818                 newdoc->\hyperlink{structplkr__Document__s_a7d7964829f29daa29f9d535723d638dc}{owner\_id\_key}[(i * 4) + 2] = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char})((crc >> 8) & 0xFF);
819                 newdoc->\hyperlink{structplkr__Document__s_a7d7964829f29daa29f9d535723d638dc}{owner\_id\_key}[(i * 4) + 3] = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char})(crc & 0xFF);
820             \}
821         \}
822         \textcolor{keywordflow}{else} \{
823             \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Document requires owner-id to open"});
824             FreePluckerDoc (newdoc);
825             \textcolor{keywordflow}{return} NULL;
826         \}
827     \}
828 
829     \textcolor{comment}{/* now do the rest of the reserved records */}
830 
831     \textcolor{keywordflow}{for} (i = 0; i < nreserved; i++) \{
832         \textcolor{keywordflow}{if} (reserved[i].name == \hyperlink{unpluckint_8h_acd51e45c8e2b63cd1e42d5dda69c1d08aae4e0fc7e0b3e82441db10dd79ea031a}{PLKR\_HOME\_NAME})
833             newdoc->\hyperlink{structplkr__Document__s_a855d2555348d33aa63c23324fca29775}{home\_record\_uid} = reserved[i].\hyperlink{structReservedRecordEntry_a584205e972ca4b5f9c25b4f38eb04eae}{uid};
834         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (reserved[i].name == \hyperlink{unpluckint_8h_acd51e45c8e2b63cd1e42d5dda69c1d08a08d2098d87813305760ffb943e6a6894}{PLKR\_DEFAULT\_CATEGORY\_NAME}) \{
835             newdoc->\hyperlink{structplkr__Document__s_aa5adb5548f84752427b973f322f153ec}{default\_category\_record\_uid} = reserved[i].
      \hyperlink{structReservedRecordEntry_a584205e972ca4b5f9c25b4f38eb04eae}{uid};
836             \textcolor{keywordflow}{if} (!ParseCategories (newdoc, handle)) \{
837                 \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Error parsing default-categories record"});
838                 FreePluckerDoc (newdoc);
839                 \textcolor{keywordflow}{return} NULL;
840             \}
841         \}
842         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (reserved[i].name == \hyperlink{unpluckint_8h_acd51e45c8e2b63cd1e42d5dda69c1d08af5747d5e9aaaed2e8f7b1140faf57cf8}{PLKR\_URLS\_INDEX\_NAME}) \{
843             newdoc->\hyperlink{structplkr__Document__s_af14f8f1e3c2eea6814bc94aff2ec428c}{urls\_index\_record\_uid} = reserved[i].\hyperlink{structReservedRecordEntry_a584205e972ca4b5f9c25b4f38eb04eae}{uid};
844             \textcolor{keywordflow}{if} (!ParseURLs (newdoc, handle)) \{
845                 \hyperlink{unpluckint_8h_a2966ae6d90817fa1522a5675380aada5}{\_plkr\_message} (\textcolor{stringliteral}{"Error parsing URLs records"});
846                 FreePluckerDoc (newdoc);
847                 \textcolor{keywordflow}{return} NULL;
848             \}
849         \}
850     \}
851 
852     newdoc->\hyperlink{structplkr__Document__s_ae1a048bf4797c696d6313c1e08ce3577}{handle} = handle;
853 
854 \textcolor{preprocessor}{#ifdef DEBUGOPEN}
855     \textcolor{comment}{/* test the record fetch by fetching them! */}
856     \textcolor{keywordflow}{for} (i = 1; i < newdoc->\hyperlink{structplkr__Document__s_a133abbdd399b433991b5e561339990f7}{nrecords}; i++) \{
857         \hyperlink{unpluck_8h_a2d3cdee2c160741b8a217b97e14b08b4}{plkr\_DataRecordType} type;
858         \textcolor{keywordtype}{int} n;
859         printf (\textcolor{stringliteral}{"==============================================\(\backslash\)n"}
860                 \textcolor{stringliteral}{"record %3d (%d bytes)\(\backslash\)n"}, newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[i].\hyperlink{structplkr__DataRecord__s_afd7b53eef587427617f90ec51d69fbeb}{uid},
861                 newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[i].\hyperlink{structplkr__DataRecord__s_ac15867fee863318b96e3f9d27a1784e6}{size});
862         (void) \hyperlink{unpluck_8cpp_adbedc945ce6c9be1f34fd5cd770a3b24}{plkr\_GetRecordBytes} (newdoc, newdoc->\hyperlink{structplkr__Document__s_a5cebe36965c1e730ac63af3a075df34a}{records}[i].
      \hyperlink{structplkr__DataRecord__s_afd7b53eef587427617f90ec51d69fbeb}{uid}, &n,
863                                     &type);
864     \}
865 \textcolor{preprocessor}{#endif}
866 
867     \textcolor{keywordflow}{return} newdoc;
868 \}
\end{DoxyCode}
