\hypertarget{classFictionBook_1_1Document}{\section{Fiction\+Book\+:\+:Document Class Reference}
\label{classFictionBook_1_1Document}\index{Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}}
}


{\ttfamily \#include $<$document.\+h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classFictionBook_1_1Document_a6a85de1f3ac9d88c2afd63d92e5e5d37}{Document} (const Q\+String \&file\+Name)
\item 
bool \hyperlink{classFictionBook_1_1Document_a21834f917a7da6d07426ecb688fbcc1f}{open} ()
\item 
Q\+Dom\+Document \hyperlink{classFictionBook_1_1Document_aaabacf81e2c82b875fe33372d628da12}{content} () const 
\item 
Q\+String \hyperlink{classFictionBook_1_1Document_a26f06a190450786328eceb700ebfe45e}{last\+Error\+String} () const 
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 20 of file document.\+h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classFictionBook_1_1Document_a6a85de1f3ac9d88c2afd63d92e5e5d37}{\index{Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}!Document@{Document}}
\index{Document@{Document}!Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}}
\subsubsection[{Document}]{\setlength{\rightskip}{0pt plus 5cm}Document\+::\+Document (
\begin{DoxyParamCaption}
\item[{const Q\+String \&}]{file\+Name}
\end{DoxyParamCaption}
)}}\label{classFictionBook_1_1Document_a6a85de1f3ac9d88c2afd63d92e5e5d37}


Definition at line 19 of file document.\+cpp.


\begin{DoxyCode}
20     : mFileName( fileName )
21 \{
22 \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{classFictionBook_1_1Document_aaabacf81e2c82b875fe33372d628da12}{\index{Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}!content@{content}}
\index{content@{content}!Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}}
\subsubsection[{content}]{\setlength{\rightskip}{0pt plus 5cm}Q\+Dom\+Document Document\+::content (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{classFictionBook_1_1Document_aaabacf81e2c82b875fe33372d628da12}


Definition at line 78 of file document.\+cpp.


\begin{DoxyCode}
79 \{
80     \textcolor{keywordflow}{return} mDocument;
81 \}
\end{DoxyCode}
\hypertarget{classFictionBook_1_1Document_a26f06a190450786328eceb700ebfe45e}{\index{Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}!last\+Error\+String@{last\+Error\+String}}
\index{last\+Error\+String@{last\+Error\+String}!Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}}
\subsubsection[{last\+Error\+String}]{\setlength{\rightskip}{0pt plus 5cm}Q\+String Document\+::last\+Error\+String (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}\label{classFictionBook_1_1Document_a26f06a190450786328eceb700ebfe45e}


Definition at line 83 of file document.\+cpp.


\begin{DoxyCode}
84 \{
85     \textcolor{keywordflow}{return} mErrorString;
86 \}
\end{DoxyCode}
\hypertarget{classFictionBook_1_1Document_a21834f917a7da6d07426ecb688fbcc1f}{\index{Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}!open@{open}}
\index{open@{open}!Fiction\+Book\+::\+Document@{Fiction\+Book\+::\+Document}}
\subsubsection[{open}]{\setlength{\rightskip}{0pt plus 5cm}bool Document\+::open (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classFictionBook_1_1Document_a21834f917a7da6d07426ecb688fbcc1f}


Definition at line 24 of file document.\+cpp.


\begin{DoxyCode}
25 \{
26     QIODevice *device;
27 
28     QFile file( mFileName );
29     KZip zip( mFileName );
30     \textcolor{keywordflow}{if} ( mFileName.endsWith( \textcolor{stringliteral}{".fb"} ) || mFileName.endsWith( \textcolor{stringliteral}{".fb2"} ) ) \{
31         \textcolor{keywordflow}{if} ( !file.open( QIODevice::ReadOnly ) ) \{
32             setError( i18n( \textcolor{stringliteral}{"Unable to open document: %1"}, file.errorString() ) );
33             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
34         \}
35 
36         device = &file;
37     \} \textcolor{keywordflow}{else} \{
38         \textcolor{keywordflow}{if} ( !zip.open( QIODevice::ReadOnly ) ) \{
39             setError( i18n( \textcolor{stringliteral}{"Document is not a valid ZIP archive"} ) );
40             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
41         \}
42 
43         \textcolor{keyword}{const} KArchiveDirectory *directory = zip.directory();
44         \textcolor{keywordflow}{if} ( !directory ) \{
45             setError( i18n( \textcolor{stringliteral}{"Invalid document structure (main directory is missing)"} ) );
46             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
47         \}
48 
49         \textcolor{keyword}{const} QStringList entries = directory->entries();
50 
51         QString documentFile;
52         \textcolor{keywordflow}{for} ( \textcolor{keywordtype}{int} i = 0; i < entries.count(); ++i ) \{
53             \textcolor{keywordflow}{if} ( entries[ i ].endsWith( \textcolor{stringliteral}{".fb2"} ) ) \{
54                 documentFile = entries[ i ];
55                 \textcolor{keywordflow}{break};
56             \}
57         \}
58 
59         \textcolor{keywordflow}{if} ( documentFile.isEmpty() ) \{
60             setError( i18n( \textcolor{stringliteral}{"No content found in the document"} ) );
61             \textcolor{keywordflow}{return} \textcolor{keyword}{false};
62         \}
63 
64         \textcolor{keyword}{const} KArchiveFile *entry = \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const }KArchiveFile*\textcolor{keyword}{>}( directory->entry( documentFile ) );
65         \textcolor{comment}{// FIXME delete 'deviceÃ¬ somewhen}
66         device = entry->createDevice();
67     \}
68 
69     QString errorMsg;
70     \textcolor{keywordflow}{if} ( !mDocument.setContent( device, \textcolor{keyword}{true}, &errorMsg ) ) \{
71         setError( i18n( \textcolor{stringliteral}{"Invalid XML document: %1"}, errorMsg ) );
72         \textcolor{keywordflow}{return} \textcolor{keyword}{false};
73     \}
74 
75     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
76 \}
\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
generators/fictionbook/\hyperlink{generators_2fictionbook_2document_8h}{document.\+h}\item 
generators/fictionbook/\hyperlink{generators_2fictionbook_2document_8cpp}{document.\+cpp}\end{DoxyCompactItemize}
